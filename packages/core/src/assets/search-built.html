<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>EasyEDA Component Browser</title>
  <style>
    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
    }

    :root {
      --bg-primary: #1a1a1a;
      --bg-secondary: #2a2a2a;
      --bg-card: #333333;
      --text-primary: #ffffff;
      --text-secondary: #aaaaaa;
      --accent: #4a9eff;
      --accent-hover: #6ab0ff;
      --success: #22c55e;
      --error: #ef4444;
      --border: #444444;
    }

    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
      background: var(--bg-primary);
      color: var(--text-primary);
      min-height: 100vh;
    }

    header {
      background: var(--bg-secondary);
      padding: 20px;
      border-bottom: 1px solid var(--border);
      position: sticky;
      top: 0;
      z-index: 100;
    }

    .header-content {
      max-width: 1400px;
      margin: 0 auto;
    }

    h1 {
      font-size: 1.5rem;
      margin-bottom: 16px;
      color: var(--text-primary);
    }

    .search-bar {
      display: flex;
      gap: 12px;
      flex-wrap: wrap;
    }

    #search-input {
      flex: 1;
      min-width: 200px;
      padding: 12px 16px;
      font-size: 16px;
      background: var(--bg-primary);
      border: 1px solid var(--border);
      border-radius: 8px;
      color: var(--text-primary);
      outline: none;
    }

    #search-input:focus {
      border-color: var(--accent);
    }

    #source-select {
      padding: 12px 16px;
      font-size: 16px;
      background: var(--bg-primary);
      border: 1px solid var(--border);
      border-radius: 8px;
      color: var(--text-primary);
      cursor: pointer;
    }

    #search-btn {
      padding: 12px 24px;
      font-size: 16px;
      background: var(--accent);
      border: none;
      border-radius: 8px;
      color: white;
      cursor: pointer;
      font-weight: 500;
      transition: background 0.2s;
    }

    #search-btn:hover {
      background: var(--accent-hover);
    }

    main {
      max-width: 1400px;
      margin: 0 auto;
      padding: 24px;
    }

    #loading {
      display: flex;
      justify-content: center;
      padding: 48px;
    }

    #loading.hidden {
      display: none;
    }

    .spinner {
      width: 40px;
      height: 40px;
      border: 3px solid var(--border);
      border-top-color: var(--accent);
      border-radius: 50%;
      animation: spin 1s linear infinite;
    }

    @keyframes spin {
      to { transform: rotate(360deg); }
    }

    #results-grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
      gap: 20px;
    }

    .card {
      background: var(--bg-card);
      border-radius: 12px;
      overflow: hidden;
      border: 1px solid var(--border);
      transition: transform 0.2s, border-color 0.2s;
    }

    .card:hover {
      transform: translateY(-2px);
      border-color: var(--accent);
    }

    .card-images {
      display: flex;
      gap: 2px;
      background: var(--border);
    }

    .image-container {
      flex: 1;
      aspect-ratio: 1;
      background: #000;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      position: relative;
      cursor: pointer;
      overflow: hidden;
    }

    .image-container img,
    .image-container svg {
      max-width: 100%;
      max-height: 100%;
      object-fit: contain;
    }

    .image-label {
      position: absolute;
      bottom: 4px;
      left: 4px;
      font-size: 10px;
      color: var(--text-secondary);
      background: rgba(0,0,0,0.7);
      padding: 2px 6px;
      border-radius: 4px;
    }

    .symbol-placeholder,
    .footprint-placeholder,
    .no-preview {
      color: var(--text-secondary);
      font-size: 12px;
    }

    .card-info {
      padding: 12px;
    }

    .card-title {
      font-weight: 600;
      margin-bottom: 8px;
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
    }

    .card-package,
    .card-owner {
      font-size: 13px;
      color: var(--text-secondary);
      margin-bottom: 4px;
    }

    .card-uuid {
      display: flex;
      padding: 8px 12px;
      background: var(--bg-secondary);
      gap: 8px;
    }

    .card-uuid input {
      flex: 1;
      background: var(--bg-primary);
      border: 1px solid var(--border);
      border-radius: 4px;
      padding: 6px 10px;
      font-size: 11px;
      font-family: monospace;
      color: var(--text-secondary);
    }

    .copy-btn {
      background: var(--accent);
      border: none;
      border-radius: 4px;
      padding: 6px 10px;
      cursor: pointer;
      color: white;
      display: flex;
      align-items: center;
      justify-content: center;
      transition: background 0.2s;
    }

    .copy-btn:hover {
      background: var(--accent-hover);
    }

    .copy-btn.copied {
      background: var(--success);
    }

    #pagination {
      display: flex;
      justify-content: center;
      align-items: center;
      gap: 16px;
      margin-top: 32px;
    }

    .page-btn {
      padding: 10px 20px;
      background: var(--bg-card);
      border: 1px solid var(--border);
      border-radius: 8px;
      color: var(--text-primary);
      cursor: pointer;
      transition: background 0.2s, border-color 0.2s;
    }

    .page-btn:hover:not(:disabled) {
      background: var(--bg-secondary);
      border-color: var(--accent);
    }

    .page-btn:disabled {
      opacity: 0.5;
      cursor: not-allowed;
    }

    .page-info {
      color: var(--text-secondary);
    }

    .no-results,
    .error {
      grid-column: 1 / -1;
      text-align: center;
      padding: 48px;
      color: var(--text-secondary);
    }

    .error {
      color: var(--error);
    }

    /* Modal */
    #preview-modal {
      position: fixed;
      inset: 0;
      background: rgba(0, 0, 0, 0.8);
      display: flex;
      align-items: center;
      justify-content: center;
      z-index: 1000;
      padding: 20px;
    }

    #preview-modal.hidden {
      display: none;
    }

    .modal-wrapper {
      background: var(--bg-secondary);
      border-radius: 16px;
      max-width: 900px;
      width: 100%;
      max-height: 90vh;
      overflow: auto;
      position: relative;
    }

    #modal-close {
      position: absolute;
      top: 16px;
      right: 16px;
      background: var(--bg-card);
      border: 1px solid var(--border);
      border-radius: 8px;
      padding: 8px 12px;
      color: var(--text-primary);
      cursor: pointer;
      font-size: 18px;
      z-index: 10;
    }

    #modal-close:hover {
      background: var(--bg-primary);
    }

    #modal-content {
      padding: 24px;
    }

    .modal-loading {
      text-align: center;
      padding: 48px;
      color: var(--text-secondary);
    }

    .modal-error {
      text-align: center;
      padding: 48px;
      color: var(--error);
    }

    .modal-header {
      margin-bottom: 24px;
    }

    .modal-header h2 {
      margin-bottom: 12px;
    }

    .modal-uuid {
      display: flex;
      align-items: center;
      gap: 12px;
    }

    .modal-uuid code {
      background: var(--bg-primary);
      padding: 8px 12px;
      border-radius: 6px;
      font-size: 14px;
      color: var(--text-secondary);
    }

    .modal-copy {
      padding: 8px 16px;
      font-size: 14px;
    }

    .modal-previews {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
      gap: 24px;
      margin-bottom: 24px;
    }

    .modal-preview h3 {
      margin-bottom: 12px;
      font-size: 14px;
      color: var(--text-secondary);
    }

    .preview-svg {
      background: #000;
      border-radius: 8px;
      aspect-ratio: 1;
      display: flex;
      align-items: center;
      justify-content: center;
      overflow: hidden;
    }

    .preview-svg svg {
      width: 100%;
      height: 100%;
    }

    .preview-svg .no-preview {
      color: var(--text-secondary);
    }

    .modal-info {
      display: flex;
      gap: 24px;
      color: var(--text-secondary);
      font-size: 14px;
    }
  </style>
</head>
<body>
  <header>
    <div class="header-content">
      <h1>EasyEDA Component Browser</h1>
      <div class="search-bar">
        <input type="text" id="search-input" placeholder="Search components (e.g., ESP32, STM32, LM7805)..." autofocus />
        <select id="source-select">
          <option value="user">Community</option>
          <option value="lcsc">LCSC</option>
          <option value="all">All Sources</option>
        </select>
        <button id="search-btn">Search</button>
      </div>
    </div>
  </header>

  <main>
    <div id="loading" class="hidden">
      <div class="spinner"></div>
    </div>
    <div id="results-grid"></div>
    <div id="pagination"></div>
  </main>

  <div id="preview-modal" class="hidden">
    <div class="modal-wrapper">
      <button id="modal-close">&times;</button>
      <div id="modal-content"></div>
    </div>
  </div>

  <script>
    function EJ(Z){let $=[],J=0;while(J<Z.length){let K=Z[J];if(/\s/.test(K)){J++;continue}if(K==="("||K===")"){$.push(K),J++;continue}if(K==='"'){let j="";J++;while(J<Z.length)if(Z[J]==="\\"&&J+1<Z.length)j+=Z[J+1],J+=2;else if(Z[J]==='"'){J++;break}else j+=Z[J],J++;$.push(`"${j}"`);continue}let U="";while(J<Z.length&&!/[\s()]/.test(Z[J]))U+=Z[J],J++;if(U)$.push(U)}return $}function ZJ(Z){if(Z.length===0)return{expr:[],remaining:[]};let $=Z[0];if($==="("){let K=[],U=Z.slice(1);while(U.length>0&&U[0]!==")"){let{expr:j,remaining:D}=ZJ(U);K.push(j),U=D}if(U[0]===")")U=U.slice(1);return{expr:K,remaining:U}}if($===")")return{expr:[],remaining:Z.slice(1)};let J=$;if(J.startsWith('"')&&J.endsWith('"'))J=J.slice(1,-1);return{expr:J,remaining:Z.slice(1)}}function l(Z){let $=EJ(Z),{expr:J}=ZJ($);return J}function F(Z){return Array.isArray(Z)}function X(Z){return typeof Z==="string"}function T(Z){if(F(Z)&&Z.length>0&&X(Z[0]))return Z[0];return}function _(Z,$){if(!F(Z))return;for(let J of Z)if(F(J)&&T(J)===$)return J;return}function M(Z,$){if(!F(Z))return[];let J=[];for(let K of Z)if(F(K)&&T(K)===$)J.push(K);return J}function g(Z,$){let J=_(Z,$);if(J&&J.length>=2&&X(J[1]))return J[1];return}function m(Z,$){let J=g(Z,$);if(J!==void 0){let K=parseFloat(J);if(!isNaN(K))return K}return}function z(Z,$){let J=_(Z,$);if(J&&J.length>=3){let K=parseFloat(X(J[1])?J[1]:""),U=parseFloat(X(J[2])?J[2]:"");if(!isNaN(K)&&!isNaN(U))return{x:K,y:U}}return}function y(Z,$){let J=_(Z,$);if(J&&J.length>=3){let K=parseFloat(X(J[1])?J[1]:""),U=parseFloat(X(J[2])?J[2]:"");if(!isNaN(K)&&!isNaN(U)){let j={x:K,y:U};if(J.length>=4&&X(J[3])){let D=parseFloat(J[3]);if(!isNaN(D))j.rotation=D}return j}}return}function d(Z){let $=_(Z,"size");if($&&$.length>=3){let J=parseFloat(X($[1])?$[1]:""),K=parseFloat(X($[2])?$[2]:"");if(!isNaN(J)&&!isNaN(K))return{width:J,height:K}}return}function B(Z){let $=_(Z,"stroke");if(!$)return;let J=m($,"width")??0.254,K=g($,"type")??"default";return{width:J,type:K}}function f(Z){let $=_(Z,"fill");if(!$)return;return g($,"type")}function c(Z){let $=_(Z,"pts");if(!$)return[];let J=[];for(let K of $)if(F(K)&&T(K)==="xy"&&K.length>=3){let U=parseFloat(X(K[1])?K[1]:""),j=parseFloat(X(K[2])?K[2]:"");if(!isNaN(U)&&!isNaN(j))J.push({x:U,y:j})}return J}function P(Z){let $=g(Z,"layer");if($)return[$];let J=_(Z,"layers");if(!J)return[];let K=[];for(let U=1;U<J.length;U++){let j=J[U];if(X(j))K.push(j)}return K}var A={background:"#FFFFF8",body:"#840000",bodyFill:"#FFFFC4",pin:"#840000",pinText:"#008484",text:"#000000"},w={background:"#000000",fCu:"#840000",bCu:"#008400",in1Cu:"#C2C200",in2Cu:"#C200C2",fSilkS:"#008484",bSilkS:"#840084",fMask:"#840084",bMask:"#848400",fPaste:"#840000",bPaste:"#00C2C2",fFab:"#848484",bFab:"#000084",fCrtYd:"#C2C2C2",bCrtYd:"#848484",edgeCuts:"#C2C200",dwgsUser:"#C2C2C2",cmtsUser:"#000084",margin:"#C200C2",padFront:"#840000",padBack:"#008400",padThruHole:"#C2C200",drill:"#848484"},L=10;function b(Z){return Z.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;")}function o(Z){if(!Z||Z.trim()==="")return S("No symbol data");try{let $=l(Z);if(!F($)||T($)!=="symbol")return S("Invalid symbol format");let J=[],K={minX:1/0,maxX:-1/0,minY:1/0,maxY:-1/0},U=M($,"symbol");for(let V of U){for(let Q of M(V,"rectangle")){let q=XJ(Q,K);if(q)J.push(q)}for(let Q of M(V,"polyline")){let q=wJ(Q,K);if(q)J.push(q)}for(let Q of M(V,"circle")){let q=MJ(Q,K);if(q)J.push(q)}for(let Q of M(V,"arc")){let q=IJ(Q,K);if(q)J.push(q)}for(let Q of M(V,"pin")){let q=YJ(Q,K);if(q)J.push(q)}}let j=5;if(!isFinite(K.minX))K.minX=-20,K.maxX=20,K.minY=-20,K.maxY=20;let D=(K.maxX-K.minX+j*2)*L,G=(K.maxY-K.minY+j*2)*L;return`<svg xmlns="http://www.w3.org/2000/svg" viewBox="${`${(K.minX-j)*L} ${(-K.maxY-j)*L} ${D} ${G}`}" width="100%" height="100%" style="background-color: ${A.background}">
  <g transform="scale(${L}, ${-L})">
    ${J.join(`
    `)}
  </g>
</svg>`}catch($){return S(`Parse error: ${$}`)}}function XJ(Z,$){let J=z(Z,"start"),K=z(Z,"end");if(!J||!K)return"";let U=B(Z),D=f(Z)==="background"?A.bodyFill:"none";E($,J.x,J.y),E($,K.x,K.y);let G=Math.min(J.x,K.x),W=Math.min(J.y,K.y),V=Math.abs(K.x-J.x),Q=Math.abs(K.y-J.y);return`<rect x="${G}" y="${W}" width="${V}" height="${Q}" fill="${D}" stroke="${A.body}" stroke-width="${U?.width??0.254}"/>`}function wJ(Z,$){let J=c(Z);if(J.length<2)return"";let K=B(Z),j=f(Z)==="background"?A.bodyFill:"none";return`<polyline points="${J.map((G)=>{return E($,G.x,G.y),`${G.x},${G.y}`}).join(" ")}" fill="${j}" stroke="${A.body}" stroke-width="${K?.width??0.254}" stroke-linecap="round" stroke-linejoin="round"/>`}function MJ(Z,$){let J=z(Z,"center"),K=m(Z,"radius");if(!J||K===void 0)return"";let U=B(Z),D=f(Z)==="background"?A.bodyFill:"none";return E($,J.x-K,J.y-K),E($,J.x+K,J.y+K),`<circle cx="${J.x}" cy="${J.y}" r="${K}" fill="${D}" stroke="${A.body}" stroke-width="${U?.width??0.254}"/>`}function IJ(Z,$){let J=z(Z,"start"),K=z(Z,"mid"),U=z(Z,"end");if(!J||!K||!U)return"";let j=B(Z);return E($,J.x,J.y),E($,K.x,K.y),E($,U.x,U.y),`<path d="${DJ(J,K,U)}" fill="none" stroke="${A.body}" stroke-width="${j?.width??0.254}" stroke-linecap="round"/>`}function DJ(Z,$,J){let{x:K,y:U}=Z,j=$.x,D=$.y,G=J.x,W=J.y,V=2*(K*(D-W)+j*(W-U)+G*(U-D));if(Math.abs(V)<0.0001)return`M ${Z.x} ${Z.y} L ${J.x} ${J.y}`;let Q=((K*K+U*U)*(D-W)+(j*j+D*D)*(W-U)+(G*G+W*W)*(U-D))/V,q=((K*K+U*U)*(G-j)+(j*j+D*D)*(K-G)+(G*G+W*W)*(j-K))/V,H=Math.sqrt((K-Q)**2+(U-q)**2),Y=(j-K)*(W-U)-(D-U)*(G-K)>0?0:1,N=0;return`M ${Z.x} ${Z.y} A ${H} ${H} 0 ${N} ${Y} ${J.x} ${J.y}`}function YJ(Z,$){let J=y(Z,"at"),K=m(Z,"length")??2.54;if(!J)return"";let U=_(Z,"name"),j=_(Z,"number"),D=U&&U.length>=2&&X(U[1])?U[1]:"",G=j&&j.length>=2&&X(j[1])?j[1]:"",W=J.rotation??0,V=W*Math.PI/180,Q=J.x+K*Math.cos(V),q=J.y+K*Math.sin(V);E($,J.x,J.y),E($,Q,q);let H=[];if(H.push(`<line x1="${J.x}" y1="${J.y}" x2="${Q}" y2="${q}" stroke="${A.pin}" stroke-width="0.254"/>`),H.push(`<circle cx="${J.x}" cy="${J.y}" r="0.3" fill="${A.pin}"/>`),D&&D!=="~"){let Y=Q,N=q,k="start",R="middle";if(W===0)Y=Q+0.5,k="start";else if(W===180)Y=Q-0.5,k="end";else if(W===90)N=q+0.5,R="hanging",k="middle";else if(W===270)N=q-0.5,R="alphabetic",k="middle";H.push(`<text x="${Y}" y="${N}" fill="${A.pinText}" font-size="1" font-family="sans-serif" text-anchor="${k}" dominant-baseline="${R}" transform="scale(1,-1) translate(0,${-2*N})">${b(D)}</text>`)}if(G){let I=(J.x+Q)/2,Y=(J.y+q)/2,N=W===0||W===180?0.8:0;H.push(`<text x="${I}" y="${Y+N}" fill="${A.pinText}" font-size="0.8" font-family="sans-serif" text-anchor="middle" dominant-baseline="middle" transform="scale(1,-1) translate(0,${-2*(Y+N)})">${b(G)}</text>`)}return H.join(`
`)}function s(Z){if(!Z||Z.trim()==="")return S("No footprint data");try{let $=l(Z);if(!F($)||T($)!=="footprint")return S("Invalid footprint format");let J=[],K={minX:1/0,maxX:-1/0,minY:1/0,maxY:-1/0};for(let W of M($,"pad")){let V=zJ(W,K);if(V)J.push(V)}for(let W of M($,"fp_line")){let V=$J(W,K);if(V)J.push(V)}for(let W of M($,"fp_circle")){let V=KJ(W,K);if(V)J.push(V)}for(let W of M($,"fp_arc")){let V=UJ(W,K);if(V)J.push(V)}for(let W of M($,"fp_rect")){let V=VJ(W,K);if(V)J.push(V)}for(let W of M($,"fp_poly")){let V=jJ(W,K);if(V)J.push(V)}for(let W of M($,"gr_line")){let V=$J(W,K);if(V)J.push(V)}for(let W of M($,"gr_circle")){let V=KJ(W,K);if(V)J.push(V)}for(let W of M($,"gr_arc")){let V=UJ(W,K);if(V)J.push(V)}for(let W of M($,"gr_rect")){let V=VJ(W,K);if(V)J.push(V)}for(let W of M($,"gr_poly")){let V=jJ(W,K);if(V)J.push(V)}for(let W of M($,"fp_text")){let V=NJ(W,K);if(V)J.push(V)}let U=1;if(!isFinite(K.minX))K.minX=-5,K.maxX=5,K.minY=-5,K.maxY=5;let j=K.maxX-K.minX+U*2,D=K.maxY-K.minY+U*2;return`<svg xmlns="http://www.w3.org/2000/svg" viewBox="${`${K.minX-U} ${K.minY-U} ${j} ${D}`}" width="100%" height="100%" style="background-color: ${w.background}">
  <g>
    ${J.join(`
    `)}
  </g>
</svg>`}catch($){return S(`Parse error: ${$}`)}}function C(Z){if(Z.includes("F.Cu"))return w.fCu;if(Z.includes("B.Cu"))return w.bCu;if(/In\d+\.Cu/.test(Z))return w.in1Cu;if(Z.includes("F.SilkS"))return w.fSilkS;if(Z.includes("B.SilkS"))return w.bSilkS;if(Z.includes("F.Mask"))return w.fMask;if(Z.includes("B.Mask"))return w.bMask;if(Z.includes("F.Paste"))return w.fPaste;if(Z.includes("B.Paste"))return w.bPaste;if(Z.includes("F.Fab"))return w.fFab;if(Z.includes("B.Fab"))return w.bFab;if(Z.includes("F.CrtYd"))return w.fCrtYd;if(Z.includes("B.CrtYd"))return w.bCrtYd;if(Z.includes("Edge.Cuts"))return w.edgeCuts;if(Z.includes("Dwgs.User"))return w.dwgsUser;if(Z.includes("Cmts.User"))return w.cmtsUser;if(Z.includes("Margin"))return w.margin;return w.fSilkS}function zJ(Z,$){if(!F(Z)||Z.length<4)return"";let J=X(Z[1])?Z[1]:"",K=X(Z[2])?Z[2]:"",U=X(Z[3])?Z[3]:"",j=y(Z,"at"),D=d(Z);if(!j||!D)return"";E($,j.x-D.width/2,j.y-D.height/2),E($,j.x+D.width/2,j.y+D.height/2);let G=[],W=P(Z),V;if(K==="thru_hole"||K==="np_thru_hole")V=w.padThruHole;else if(W.some((H)=>H.includes("B.")))V=w.padBack;else V=w.padFront;let Q=j.rotation??0,q=Q!==0?` transform="rotate(${Q}, ${j.x}, ${j.y})"`:"";if(U==="circle"){let H=Math.min(D.width,D.height)/2;G.push(`<circle cx="${j.x}" cy="${j.y}" r="${H}" fill="${V}"${q}/>`)}else if(U==="oval"){let H=D.width/2,I=D.height/2;G.push(`<ellipse cx="${j.x}" cy="${j.y}" rx="${H}" ry="${I}" fill="${V}"${q}/>`)}else if(U==="roundrect"){let H=m(Z,"roundrect_rratio")??0.25,I=Math.min(D.width,D.height)*H/2,Y=j.x-D.width/2,N=j.y-D.height/2;G.push(`<rect x="${Y}" y="${N}" width="${D.width}" height="${D.height}" rx="${I}" fill="${V}"${q}/>`)}else if(U==="custom"){let H=_(Z,"primitives");if(H)for(let I of M(H,"gr_poly")){let Y=c(I);if(Y.length>=3){let N=Y.map((k)=>{let R=j.x+k.x,JJ=j.y+k.y;return E($,R,JJ),`${R},${JJ}`}).join(" ");G.push(`<polygon points="${N}" fill="${V}"${q}/>`)}}if(G.length===0){let I=j.x-D.width/2,Y=j.y-D.height/2;G.push(`<rect x="${I}" y="${Y}" width="${D.width}" height="${D.height}" fill="${V}"${q}/>`)}}else{let H=j.x-D.width/2,I=j.y-D.height/2;G.push(`<rect x="${H}" y="${I}" width="${D.width}" height="${D.height}" fill="${V}"${q}/>`)}if(K==="thru_hole"||K==="np_thru_hole"){let H=_(Z,"drill");if(H&&H.length>=2)if(X(H[1])&&H[1]==="oval"&&H.length>=4){let Y=parseFloat(X(H[2])?H[2]:"0"),N=parseFloat(X(H[3])?H[3]:"0");G.push(`<ellipse cx="${j.x}" cy="${j.y}" rx="${Y/2}" ry="${N/2}" fill="${w.drill}"${q}/>`)}else{let Y=parseFloat(X(H[1])?H[1]:"0");G.push(`<circle cx="${j.x}" cy="${j.y}" r="${Y/2}" fill="${w.drill}"/>`)}}if(J){let H=Math.min(D.width,D.height)*0.5;G.push(`<text x="${j.x}" y="${j.y}" fill="#FFFFFF" font-size="${H}" font-family="sans-serif" text-anchor="middle" dominant-baseline="central">${b(J)}</text>`)}return G.join(`
`)}function $J(Z,$){let J=z(Z,"start"),K=z(Z,"end");if(!J||!K)return"";let U=B(Z),D=P(Z)[0]??"F.SilkS";if(D.includes("CrtYd"))return"";let G=C(D);return E($,J.x,J.y),E($,K.x,K.y),`<line x1="${J.x}" y1="${J.y}" x2="${K.x}" y2="${K.y}" stroke="${G}" stroke-width="${U?.width??0.15}" stroke-linecap="round"/>`}function KJ(Z,$){let J=z(Z,"center"),K=z(Z,"end");if(!J||!K)return"";let U=Math.sqrt((K.x-J.x)**2+(K.y-J.y)**2),j=B(Z),G=P(Z)[0]??"F.SilkS";if(G.includes("CrtYd"))return"";let W=C(G);return E($,J.x-U,J.y-U),E($,J.x+U,J.y+U),`<circle cx="${J.x}" cy="${J.y}" r="${U}" fill="none" stroke="${W}" stroke-width="${j?.width??0.15}"/>`}function UJ(Z,$){let J=z(Z,"start"),K=z(Z,"mid"),U=z(Z,"end");if(!J||!K||!U)return"";let j=B(Z),G=P(Z)[0]??"F.SilkS";if(G.includes("CrtYd"))return"";let W=C(G);return E($,J.x,J.y),E($,K.x,K.y),E($,U.x,U.y),`<path d="${DJ(J,K,U)}" fill="none" stroke="${W}" stroke-width="${j?.width??0.15}" stroke-linecap="round"/>`}function jJ(Z,$){let J=c(Z);if(J.length<3)return"";let U=P(Z)[0]??"F.Cu";if(U.includes("CrtYd"))return"";let j=C(U),D=B(Z),G=f(Z),W=G==="solid"||G==="yes"?j:"none",V=J.map((H)=>{return E($,H.x,H.y),`${H.x},${H.y}`}).join(" "),Q=D?.width??0,q=Q>0?` stroke="${j}" stroke-width="${Q}"`:"";return`<polygon points="${V}" fill="${W}"${q}/>`}function VJ(Z,$){let J=z(Z,"start"),K=z(Z,"end");if(!J||!K)return"";let j=P(Z)[0]??"F.SilkS";if(j.includes("CrtYd"))return"";let D=C(j),G=B(Z),V=f(Z)==="solid"?D:"none";E($,J.x,J.y),E($,K.x,K.y);let Q=Math.min(J.x,K.x),q=Math.min(J.y,K.y),H=Math.abs(K.x-J.x),I=Math.abs(K.y-J.y);return`<rect x="${Q}" y="${q}" width="${H}" height="${I}" fill="${V}" stroke="${D}" stroke-width="${G?.width??0.15}"/>`}function NJ(Z,$){if(!F(Z)||Z.length<3)return"";let J=X(Z[1])?Z[1]:"",K=X(Z[2])?Z[2]:"";if(J==="reference"||J==="value")return"";let U=y(Z,"at");if(!U)return"";let D=P(Z)[0]??"F.SilkS",G=C(D),W=_(Z,"effects"),V=1;if(W){let H=_(W,"font");if(H){let I=d(H);if(I)V=I.height}}E($,U.x-2,U.y-1),E($,U.x+2,U.y+1);let Q=U.rotation??0,q=Q!==0?` transform="rotate(${Q}, ${U.x}, ${U.y})"`:"";return`<text x="${U.x}" y="${U.y}" fill="${G}" font-size="${V}" font-family="sans-serif" text-anchor="middle" dominant-baseline="central"${q}>${b(K)}</text>`}function E(Z,$,J){Z.minX=Math.min(Z.minX,$),Z.maxX=Math.max(Z.maxX,$),Z.minY=Math.min(Z.minY,J),Z.maxY=Math.max(Z.maxY,J)}function S(Z){return`<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 200 100" width="100%" height="100%">
  <rect width="200" height="100" fill="#FFF0F0"/>
  <text x="100" y="50" fill="#CC0000" font-size="12" font-family="sans-serif" text-anchor="middle" dominant-baseline="central">${b(Z)}</text>
</svg>`}var e=1,h="",qJ="user",a=!1,i=null,x=document.getElementById("search-input"),WJ=document.getElementById("source-select"),_J=document.getElementById("search-btn"),t=document.getElementById("results-grid"),n=document.getElementById("pagination"),AJ=document.getElementById("loading"),p=document.getElementById("preview-modal"),u=document.getElementById("modal-content"),FJ=document.getElementById("modal-close");function GJ(){let Z=window.__INITIAL_QUERY__;if(Z)x.value=Z,h=Z,v();else{let J=new URLSearchParams(window.location.search).get("q");if(J)x.value=J,h=J,v()}x.addEventListener("input",BJ),x.addEventListener("keydown",($)=>{if($.key==="Enter")$.preventDefault(),v()}),_J.addEventListener("click",v),WJ.addEventListener("change",()=>{if(qJ=WJ.value,h)v()}),FJ.addEventListener("click",r),p.addEventListener("click",($)=>{if($.target===p)r()}),document.addEventListener("keydown",($)=>{if($.key==="Escape")r()})}function BJ(){if(i)clearTimeout(i);i=window.setTimeout(()=>{let Z=x.value.trim();if(Z&&Z!==h)h=Z,e=1,v()},300)}async function v(){let Z=x.value.trim();if(!Z||a)return;h=Z,a=!0,HJ(!0);try{let $=new URLSearchParams({q:Z,source:qJ,page:String(e),limit:"20"}),J=await fetch(`/api/search?${$}`);if(!J.ok)throw new Error("Search failed");let K=await J.json();kJ(K.results),RJ(K.pagination)}catch($){console.error("Search error:",$),t.innerHTML='<div class="error">Search failed. Please try again.</div>'}finally{a=!1,HJ(!1)}}function kJ(Z){if(Z.length===0){t.innerHTML='<div class="no-results">No components found. Try a different search term.</div>';return}t.innerHTML=Z.map(($)=>`
    <div class="card" data-uuid="${$.uuid}">
      <div class="card-images">
        <div class="image-container symbol-container" data-uuid="${$.uuid}">
          <div class="symbol-placeholder">Loading...</div>
          <div class="image-label">Symbol</div>
        </div>
        <div class="image-container footprint-container" data-uuid="${$.uuid}">
          <div class="footprint-placeholder">Loading...</div>
          <div class="image-label">Footprint</div>
        </div>
      </div>
      <div class="card-info">
        <div class="card-title" title="${O($.title)}">${O($.title)}</div>
        <div class="card-package">Package: ${O($.package||"Unknown")}</div>
        <div class="card-owner">By: ${O($.owner.nickname||$.owner.username)}</div>
      </div>
      <div class="card-uuid">
        <input type="text" value="${$.uuid}" readonly />
        <button class="copy-btn" data-uuid="${$.uuid}" title="Copy UUID">
          <svg viewBox="0 0 24 24" width="16" height="16"><path fill="currentColor" d="M16 1H4c-1.1 0-2 .9-2 2v14h2V3h12V1zm3 4H8c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h11c1.1 0 2-.9 2-2V7c0-1.1-.9-2-2-2zm0 16H8V7h11v14z"/></svg>
        </button>
      </div>
    </div>
  `).join(""),document.querySelectorAll(".copy-btn").forEach(($)=>{$.addEventListener("click",(J)=>{J.stopPropagation();let K=$.dataset.uuid;if(K)QJ(K,$)})}),document.querySelectorAll(".image-container").forEach(($)=>{$.addEventListener("click",async()=>{let J=$.dataset.uuid;if(J)vJ(J)})}),Z.forEach(($)=>PJ($.uuid))}async function PJ(Z){let $=document.querySelector(`.symbol-container[data-uuid="${Z}"]`),J=document.querySelector(`.footprint-container[data-uuid="${Z}"]`);if(!$&&!J)return;try{let K=await fetch(`/api/component/${Z}`);if(!K.ok){if($)$.innerHTML='<div class="no-preview">Error</div><div class="image-label">Symbol</div>';if(J)J.innerHTML='<div class="no-preview">Error</div><div class="image-label">Footprint</div>';return}let U=await K.json();if($)if(U.symbolSexpr){let j=o(U.symbolSexpr);$.innerHTML=j+'<div class="image-label">Symbol</div>'}else $.innerHTML='<div class="no-preview">No preview</div><div class="image-label">Symbol</div>';if(J)if(U.footprintSexpr){let j=s(U.footprintSexpr);J.innerHTML=j+'<div class="image-label">Footprint</div>'}else J.innerHTML='<div class="no-preview">No preview</div><div class="image-label">Footprint</div>'}catch{if($)$.innerHTML='<div class="no-preview">Error</div><div class="image-label">Symbol</div>';if(J)J.innerHTML='<div class="no-preview">Error</div><div class="image-label">Footprint</div>'}}async function vJ(Z){p.classList.remove("hidden"),u.innerHTML='<div class="modal-loading">Loading...</div>';try{let $=await fetch(`/api/component/${Z}`);if(!$.ok)throw new Error("Failed to fetch component");let J=await $.json(),K=J.symbolSexpr?o(J.symbolSexpr):"",U=J.footprintSexpr?s(J.footprintSexpr):"";u.innerHTML=`
      <div class="modal-header">
        <h2>${O(J.title)}</h2>
        <div class="modal-uuid">
          <code>${J.uuid}</code>
          <button class="copy-btn modal-copy" data-uuid="${J.uuid}">Copy UUID</button>
        </div>
      </div>
      <div class="modal-previews">
        <div class="modal-preview">
          <h3>Symbol (KiCad)</h3>
          <div class="preview-svg">${K||'<div class="no-preview">No symbol preview</div>'}</div>
        </div>
        <div class="modal-preview">
          <h3>Footprint (KiCad)</h3>
          <div class="preview-svg">${U||'<div class="no-preview">No footprint preview</div>'}</div>
        </div>
      </div>
      <div class="modal-info">
        <p><strong>Description:</strong> ${O(J.description||"N/A")}</p>
        ${J.model3d?"<p><strong>3D Model:</strong> Available</p>":""}
      </div>
    `;let j=u.querySelector(".modal-copy");if(j)j.addEventListener("click",()=>{QJ(J.uuid,j)})}catch($){console.error("Modal error:",$),u.innerHTML='<div class="modal-error">Failed to load component details</div>'}}function r(){p.classList.add("hidden")}function RJ(Z){if(Z.totalPages<=1){n.innerHTML="";return}n.innerHTML=`
    <button class="page-btn" ${Z.hasPrev?"":"disabled"} data-page="${Z.page-1}">
      ← Prev
    </button>
    <span class="page-info">Page ${Z.page} of ${Z.totalPages}</span>
    <button class="page-btn" ${Z.hasNext?"":"disabled"} data-page="${Z.page+1}">
      Next →
    </button>
  `,n.querySelectorAll(".page-btn").forEach(($)=>{$.addEventListener("click",()=>{let J=parseInt($.dataset.page||"1",10);if(J>0)e=J,v(),window.scrollTo(0,0)})})}async function QJ(Z,$){try{await navigator.clipboard.writeText(Z),$.classList.add("copied"),setTimeout(()=>$.classList.remove("copied"),1500)}catch{let J=document.createElement("input");J.value=Z,document.body.appendChild(J),J.select(),document.execCommand("copy"),document.body.removeChild(J),$.classList.add("copied"),setTimeout(()=>$.classList.remove("copied"),1500)}}function HJ(Z){AJ.classList.toggle("hidden",!Z)}function O(Z){let $=document.createElement("div");return $.textContent=Z,$.innerHTML}if(document.readyState==="loading")document.addEventListener("DOMContentLoaded",GJ);else GJ();

  </script>
</body>
</html>
