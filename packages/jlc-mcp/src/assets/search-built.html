<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>EasyEDA Component Browser</title>
  <style>
    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
    }

    :root {
      --bg-primary: #1a1a1a;
      --bg-secondary: #2a2a2a;
      --bg-card: #333333;
      --text-primary: #ffffff;
      --text-secondary: #aaaaaa;
      --accent: #4a9eff;
      --accent-hover: #6ab0ff;
      --success: #22c55e;
      --error: #ef4444;
      --border: #444444;
    }

    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
      background: var(--bg-primary);
      color: var(--text-primary);
      min-height: 100vh;
    }

    header {
      background: var(--bg-secondary);
      padding: 20px;
      border-bottom: 1px solid var(--border);
      position: sticky;
      top: 0;
      z-index: 100;
    }

    .header-content {
      max-width: 1400px;
      margin: 0 auto;
    }

    h1 {
      font-size: 1.5rem;
      margin-bottom: 16px;
      color: var(--text-primary);
    }

    .search-bar {
      display: flex;
      gap: 12px;
      flex-wrap: wrap;
    }

    #search-input {
      flex: 1;
      min-width: 200px;
      padding: 12px 16px;
      font-size: 16px;
      background: var(--bg-primary);
      border: 1px solid var(--border);
      border-radius: 8px;
      color: var(--text-primary);
      outline: none;
    }

    #search-input:focus {
      border-color: var(--accent);
    }

    #source-select {
      padding: 12px 16px;
      font-size: 16px;
      background: var(--bg-primary);
      border: 1px solid var(--border);
      border-radius: 8px;
      color: var(--text-primary);
      cursor: pointer;
    }

    #search-btn {
      padding: 12px 24px;
      font-size: 16px;
      background: var(--accent);
      border: none;
      border-radius: 8px;
      color: white;
      cursor: pointer;
      font-weight: 500;
      transition: background 0.2s;
    }

    #search-btn:hover {
      background: var(--accent-hover);
    }

    main {
      max-width: 1400px;
      margin: 0 auto;
      padding: 24px;
    }

    #loading {
      display: flex;
      justify-content: center;
      padding: 48px;
    }

    #loading.hidden {
      display: none;
    }

    .spinner {
      width: 40px;
      height: 40px;
      border: 3px solid var(--border);
      border-top-color: var(--accent);
      border-radius: 50%;
      animation: spin 1s linear infinite;
    }

    @keyframes spin {
      to { transform: rotate(360deg); }
    }

    #results-grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
      gap: 20px;
    }

    .card {
      background: var(--bg-card);
      border-radius: 12px;
      overflow: hidden;
      border: 1px solid var(--border);
      transition: transform 0.2s, border-color 0.2s;
    }

    .card:hover {
      transform: translateY(-2px);
      border-color: var(--accent);
    }

    .card-images {
      display: flex;
      gap: 2px;
      background: var(--border);
    }

    .image-container {
      flex: 1;
      aspect-ratio: 1;
      background: #000;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      position: relative;
      cursor: pointer;
      overflow: hidden;
    }

    .image-container img,
    .image-container svg {
      max-width: 100%;
      max-height: 100%;
      object-fit: contain;
    }

    .image-label {
      position: absolute;
      bottom: 4px;
      left: 4px;
      font-size: 10px;
      color: var(--text-secondary);
      background: rgba(0,0,0,0.7);
      padding: 2px 6px;
      border-radius: 4px;
    }

    .symbol-placeholder,
    .footprint-placeholder,
    .no-preview {
      color: var(--text-secondary);
      font-size: 12px;
    }

    .card-info {
      padding: 12px;
    }

    .card-title {
      font-weight: 600;
      margin-bottom: 8px;
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
    }

    .card-package,
    .card-owner {
      font-size: 13px;
      color: var(--text-secondary);
      margin-bottom: 4px;
    }

    .card-uuid {
      display: flex;
      padding: 8px 12px;
      background: var(--bg-secondary);
      gap: 8px;
    }

    .card-uuid input {
      flex: 1;
      background: var(--bg-primary);
      border: 1px solid var(--border);
      border-radius: 4px;
      padding: 6px 10px;
      font-size: 11px;
      font-family: monospace;
      color: var(--text-secondary);
    }

    .copy-btn {
      background: var(--accent);
      border: none;
      border-radius: 4px;
      padding: 6px 10px;
      cursor: pointer;
      color: white;
      display: flex;
      align-items: center;
      justify-content: center;
      transition: background 0.2s;
    }

    .copy-btn:hover {
      background: var(--accent-hover);
    }

    .copy-btn.copied {
      background: var(--success);
    }

    #pagination {
      display: flex;
      justify-content: center;
      align-items: center;
      gap: 16px;
      margin-top: 32px;
    }

    .page-btn {
      padding: 10px 20px;
      background: var(--bg-card);
      border: 1px solid var(--border);
      border-radius: 8px;
      color: var(--text-primary);
      cursor: pointer;
      transition: background 0.2s, border-color 0.2s;
    }

    .page-btn:hover:not(:disabled) {
      background: var(--bg-secondary);
      border-color: var(--accent);
    }

    .page-btn:disabled {
      opacity: 0.5;
      cursor: not-allowed;
    }

    .page-info {
      color: var(--text-secondary);
    }

    .no-results,
    .error {
      grid-column: 1 / -1;
      text-align: center;
      padding: 48px;
      color: var(--text-secondary);
    }

    .error {
      color: var(--error);
    }

    /* Modal */
    #preview-modal {
      position: fixed;
      inset: 0;
      background: rgba(0, 0, 0, 0.8);
      display: flex;
      align-items: center;
      justify-content: center;
      z-index: 1000;
      padding: 20px;
    }

    #preview-modal.hidden {
      display: none;
    }

    .modal-wrapper {
      background: var(--bg-secondary);
      border-radius: 16px;
      max-width: 900px;
      width: 100%;
      max-height: 90vh;
      overflow: auto;
      position: relative;
    }

    #modal-close {
      position: absolute;
      top: 16px;
      right: 16px;
      background: var(--bg-card);
      border: 1px solid var(--border);
      border-radius: 8px;
      padding: 8px 12px;
      color: var(--text-primary);
      cursor: pointer;
      font-size: 18px;
      z-index: 10;
    }

    #modal-close:hover {
      background: var(--bg-primary);
    }

    #modal-content {
      padding: 24px;
    }

    .modal-loading {
      text-align: center;
      padding: 48px;
      color: var(--text-secondary);
    }

    .modal-error {
      text-align: center;
      padding: 48px;
      color: var(--error);
    }

    .modal-header {
      margin-bottom: 24px;
    }

    .modal-header h2 {
      margin-bottom: 12px;
    }

    .modal-uuid {
      display: flex;
      align-items: center;
      gap: 12px;
    }

    .modal-uuid code {
      background: var(--bg-primary);
      padding: 8px 12px;
      border-radius: 6px;
      font-size: 14px;
      color: var(--text-secondary);
    }

    .modal-copy {
      padding: 8px 16px;
      font-size: 14px;
    }

    .modal-previews {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
      gap: 24px;
      margin-bottom: 24px;
    }

    .modal-preview h3 {
      margin-bottom: 12px;
      font-size: 14px;
      color: var(--text-secondary);
    }

    .preview-svg {
      background: #000;
      border-radius: 8px;
      aspect-ratio: 1;
      display: flex;
      align-items: center;
      justify-content: center;
      overflow: hidden;
    }

    .preview-svg svg {
      width: 100%;
      height: 100%;
    }

    .preview-svg .no-preview {
      color: var(--text-secondary);
    }

    .modal-info {
      display: flex;
      gap: 24px;
      color: var(--text-secondary);
      font-size: 14px;
    }
  </style>
</head>
<body>
  <header>
    <div class="header-content">
      <h1>EasyEDA Component Browser</h1>
      <div class="search-bar">
        <input type="text" id="search-input" placeholder="Search components (e.g., ESP32, STM32, LM7805)..." autofocus />
        <select id="source-select">
          <option value="user">Community</option>
          <option value="lcsc">LCSC</option>
          <option value="all">All Sources</option>
        </select>
        <button id="search-btn">Search</button>
      </div>
    </div>
  </header>

  <main>
    <div id="loading" class="hidden">
      <div class="spinner"></div>
    </div>
    <div id="results-grid"></div>
    <div id="pagination"></div>
  </main>

  <div id="preview-modal" class="hidden">
    <div class="modal-wrapper">
      <button id="modal-close">&times;</button>
      <div id="modal-content"></div>
    </div>
  </div>

  <script>
    function DJ(Z){let $=[],J=0;while(J<Z.length){let K=Z[J];if(/\s/.test(K)){J++;continue}if(K==="("||K===")"){$.push(K),J++;continue}if(K==='"'){let j="";J++;while(J<Z.length)if(Z[J]==="\\"&&J+1<Z.length)j+=Z[J+1],J+=2;else if(Z[J]==='"'){J++;break}else j+=Z[J],J++;$.push(`"${j}"`);continue}let U="";while(J<Z.length&&!/[\s()]/.test(Z[J]))U+=Z[J],J++;if(U)$.push(U)}return $}function ZJ(Z){if(Z.length===0)return{expr:[],remaining:[]};let $=Z[0];if($==="("){let K=[],U=Z.slice(1);while(U.length>0&&U[0]!==")"){let{expr:j,remaining:V}=ZJ(U);K.push(j),U=V}if(U[0]===")")U=U.slice(1);return{expr:K,remaining:U}}if($===")")return{expr:[],remaining:Z.slice(1)};let J=$;if(J.startsWith('"')&&J.endsWith('"'))J=J.slice(1,-1);return{expr:J,remaining:Z.slice(1)}}function p(Z){let $=DJ(Z),{expr:J}=ZJ($);return J}function k(Z){return Array.isArray(Z)}function E(Z){return typeof Z==="string"}function R(Z){if(k(Z)&&Z.length>0&&E(Z[0]))return Z[0];return}function N(Z,$){if(!k(Z))return;for(let J of Z)if(k(J)&&R(J)===$)return J;return}function _(Z,$){if(!k(Z))return[];let J=[];for(let K of Z)if(k(K)&&R(K)===$)J.push(K);return J}function y(Z,$){let J=N(Z,$);if(J&&J.length>=2&&E(J[1]))return J[1];return}function S(Z,$){let J=y(Z,$);if(J!==void 0){let K=parseFloat(J);if(!isNaN(K))return K}return}function F(Z,$){let J=N(Z,$);if(J&&J.length>=3){let K=parseFloat(E(J[1])?J[1]:""),U=parseFloat(E(J[2])?J[2]:"");if(!isNaN(K)&&!isNaN(U))return{x:K,y:U}}return}function g(Z,$){let J=N(Z,$);if(J&&J.length>=3){let K=parseFloat(E(J[1])?J[1]:""),U=parseFloat(E(J[2])?J[2]:"");if(!isNaN(K)&&!isNaN(U)){let j={x:K,y:U};if(J.length>=4&&E(J[3])){let V=parseFloat(J[3]);if(!isNaN(V))j.rotation=V}return j}}return}function l(Z){let $=N(Z,"size");if($&&$.length>=3){let J=parseFloat(E($[1])?$[1]:""),K=parseFloat(E($[2])?$[2]:"");if(!isNaN(J)&&!isNaN(K))return{width:J,height:K}}return}function A(Z){let $=N(Z,"stroke");if(!$)return;let J=S($,"width")??0.254,K=y($,"type")??"default";return{width:J,type:K}}function m(Z){let $=N(Z,"fill");if(!$)return;return y($,"type")}function o(Z){let $=N(Z,"pts");if(!$)return[];let J=[];for(let K of $)if(k(K)&&R(K)==="xy"&&K.length>=3){let U=parseFloat(E(K[1])?K[1]:""),j=parseFloat(E(K[2])?K[2]:"");if(!isNaN(U)&&!isNaN(j))J.push({x:U,y:j})}return J}function T(Z){let $=y(Z,"layer");if($)return[$];let J=N(Z,"layers");if(!J)return[];let K=[];for(let U=1;U<J.length;U++)if(E(J[U]))K.push(J[U]);return K}var z={background:"#FFFFF8",body:"#840000",bodyFill:"#FFFFC4",pin:"#840000",pinText:"#008484",text:"#000000"},Y={background:"#000000",fCu:"#CC0000",bCu:"#0066CC",fSilkS:"#00FFFF",bSilkS:"#FF00FF",fFab:"#C4A000",fMask:"#660066",drill:"#666666",courtyard:"#444444",edgeCuts:"#C4C400"},v=10;function C(Z){return Z.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;")}function d(Z){if(!Z||Z.trim()==="")return f("No symbol data");try{let $=p(Z);if(!k($)||R($)!=="symbol")return f("Invalid symbol format");let J=[],K={minX:1/0,maxX:-1/0,minY:1/0,maxY:-1/0},U=_($,"symbol");for(let D of U){for(let q of _(D,"rectangle")){let H=QJ(q,K);if(H)J.push(H)}for(let q of _(D,"polyline")){let H=GJ(q,K);if(H)J.push(H)}for(let q of _(D,"circle")){let H=HJ(q,K);if(H)J.push(H)}for(let q of _(D,"arc")){let H=qJ(q,K);if(H)J.push(H)}for(let q of _(D,"pin")){let H=EJ(q,K);if(H)J.push(H)}}let j=5;if(!isFinite(K.minX))K.minX=-20,K.maxX=20,K.minY=-20,K.maxY=20;let V=(K.maxX-K.minX+j*2)*v,W=(K.maxY-K.minY+j*2)*v;return`<svg xmlns="http://www.w3.org/2000/svg" viewBox="${`${(K.minX-j)*v} ${(-K.maxY-j)*v} ${V} ${W}`}" width="100%" height="100%" style="background-color: ${z.background}">
  <g transform="scale(${v}, ${-v})">
    ${J.join(`
    `)}
  </g>
</svg>`}catch($){return f(`Parse error: ${$}`)}}function QJ(Z,$){let J=F(Z,"start"),K=F(Z,"end");if(!J||!K)return"";let U=A(Z),V=m(Z)==="background"?z.bodyFill:"none";X($,J.x,J.y),X($,K.x,K.y);let W=Math.min(J.x,K.x),Q=Math.min(J.y,K.y),D=Math.abs(K.x-J.x),q=Math.abs(K.y-J.y);return`<rect x="${W}" y="${Q}" width="${D}" height="${q}" fill="${V}" stroke="${z.body}" stroke-width="${U?.width??0.254}"/>`}function GJ(Z,$){let J=o(Z);if(J.length<2)return"";let K=A(Z),j=m(Z)==="background"?z.bodyFill:"none";return`<polyline points="${J.map((W)=>{return X($,W.x,W.y),`${W.x},${W.y}`}).join(" ")}" fill="${j}" stroke="${z.body}" stroke-width="${K?.width??0.254}" stroke-linecap="round" stroke-linejoin="round"/>`}function HJ(Z,$){let J=F(Z,"center"),K=S(Z,"radius");if(!J||K===void 0)return"";let U=A(Z),V=m(Z)==="background"?z.bodyFill:"none";return X($,J.x-K,J.y-K),X($,J.x+K,J.y+K),`<circle cx="${J.x}" cy="${J.y}" r="${K}" fill="${V}" stroke="${z.body}" stroke-width="${U?.width??0.254}"/>`}function qJ(Z,$){let J=F(Z,"start"),K=F(Z,"mid"),U=F(Z,"end");if(!J||!K||!U)return"";let j=A(Z);return X($,J.x,J.y),X($,K.x,K.y),X($,U.x,U.y),`<path d="${$J(J,K,U)}" fill="none" stroke="${z.body}" stroke-width="${j?.width??0.254}" stroke-linecap="round"/>`}function $J(Z,$,J){let{x:K,y:U}=Z,j=$.x,V=$.y,W=J.x,Q=J.y,D=2*(K*(V-Q)+j*(Q-U)+W*(U-V));if(Math.abs(D)<0.0001)return`M ${Z.x} ${Z.y} L ${J.x} ${J.y}`;let q=((K*K+U*U)*(V-Q)+(j*j+V*V)*(Q-U)+(W*W+Q*Q)*(U-V))/D,H=((K*K+U*U)*(W-j)+(j*j+V*V)*(K-W)+(W*W+Q*Q)*(j-K))/D,G=Math.sqrt((K-q)**2+(U-H)**2),w=(j-K)*(Q-U)-(V-U)*(W-K)>0?0:1,M=0;return`M ${Z.x} ${Z.y} A ${G} ${G} 0 ${M} ${w} ${J.x} ${J.y}`}function EJ(Z,$){let J=g(Z,"at"),K=S(Z,"length")??2.54;if(!J)return"";let U=N(Z,"name"),j=N(Z,"number"),V=U&&U.length>=2&&E(U[1])?U[1]:"",W=j&&j.length>=2&&E(j[1])?j[1]:"",Q=J.rotation??0,D=Q*Math.PI/180,q=J.x+K*Math.cos(D),H=J.y+K*Math.sin(D);X($,J.x,J.y),X($,q,H);let G=[];if(G.push(`<line x1="${J.x}" y1="${J.y}" x2="${q}" y2="${H}" stroke="${z.pin}" stroke-width="0.254"/>`),G.push(`<circle cx="${J.x}" cy="${J.y}" r="0.3" fill="${z.pin}"/>`),V&&V!=="~"){let w=q,M=H,P="start",B="middle";if(Q===0)w=q+0.5,P="start";else if(Q===180)w=q-0.5,P="end";else if(Q===90)M=H+0.5,B="hanging",P="middle";else if(Q===270)M=H-0.5,B="alphabetic",P="middle";G.push(`<text x="${w}" y="${M}" fill="${z.pinText}" font-size="1" font-family="sans-serif" text-anchor="${P}" dominant-baseline="${B}" transform="scale(1,-1) translate(0,${-2*M})">${C(V)}</text>`)}if(W){let I=(J.x+q)/2,w=(J.y+H)/2,M=Q===0||Q===180?0.8:0;G.push(`<text x="${I}" y="${w+M}" fill="${z.pinText}" font-size="0.8" font-family="sans-serif" text-anchor="middle" dominant-baseline="middle" transform="scale(1,-1) translate(0,${-2*(w+M)})">${C(W)}</text>`)}return G.join(`
`)}function s(Z){if(!Z||Z.trim()==="")return f("No footprint data");try{let $=p(Z);if(!k($)||R($)!=="footprint")return f("Invalid footprint format");let J=[],K={minX:1/0,maxX:-1/0,minY:1/0,maxY:-1/0};for(let Q of _($,"pad")){let D=XJ(Q,K);if(D)J.push(D)}for(let Q of _($,"fp_line")){let D=wJ(Q,K);if(D)J.push(D)}for(let Q of _($,"fp_circle")){let D=IJ(Q,K);if(D)J.push(D)}for(let Q of _($,"fp_arc")){let D=MJ(Q,K);if(D)J.push(D)}for(let Q of _($,"fp_text")){let D=NJ(Q,K);if(D)J.push(D)}let U=1;if(!isFinite(K.minX))K.minX=-5,K.maxX=5,K.minY=-5,K.maxY=5;let j=K.maxX-K.minX+U*2,V=K.maxY-K.minY+U*2;return`<svg xmlns="http://www.w3.org/2000/svg" viewBox="${`${K.minX-U} ${K.minY-U} ${j} ${V}`}" width="100%" height="100%" style="background-color: ${Y.background}">
  <g>
    ${J.join(`
    `)}
  </g>
</svg>`}catch($){return f(`Parse error: ${$}`)}}function b(Z){if(Z.includes("F.Cu"))return Y.fCu;if(Z.includes("B.Cu"))return Y.bCu;if(Z.includes("F.SilkS"))return Y.fSilkS;if(Z.includes("B.SilkS"))return Y.bSilkS;if(Z.includes("F.Fab"))return Y.fFab;if(Z.includes("F.CrtYd"))return Y.courtyard;if(Z.includes("Edge.Cuts"))return Y.edgeCuts;return Y.fSilkS}function XJ(Z,$){if(!k(Z)||Z.length<4)return"";let J=E(Z[1])?Z[1]:"",K=E(Z[2])?Z[2]:"",U=E(Z[3])?Z[3]:"",j=g(Z,"at"),V=l(Z);if(!j||!V)return"";X($,j.x-V.width/2,j.y-V.height/2),X($,j.x+V.width/2,j.y+V.height/2);let W=[],D=T(Z).some((G)=>G.includes("B."))?Y.bCu:Y.fCu,q=j.rotation??0,H=q!==0?` transform="rotate(${q}, ${j.x}, ${j.y})"`:"";if(U==="circle"){let G=Math.min(V.width,V.height)/2;W.push(`<circle cx="${j.x}" cy="${j.y}" r="${G}" fill="${D}"${H}/>`)}else if(U==="oval"){let G=V.width/2,I=V.height/2;W.push(`<ellipse cx="${j.x}" cy="${j.y}" rx="${G}" ry="${I}" fill="${D}"${H}/>`)}else if(U==="roundrect"){let G=S(Z,"roundrect_rratio")??0.25,I=Math.min(V.width,V.height)*G/2,w=j.x-V.width/2,M=j.y-V.height/2;W.push(`<rect x="${w}" y="${M}" width="${V.width}" height="${V.height}" rx="${I}" fill="${D}"${H}/>`)}else if(U==="custom"){let G=N(Z,"primitives");if(G)for(let I of _(G,"gr_poly")){let w=o(I);if(w.length>=3){let M=w.map((P)=>{let B=j.x+P.x,JJ=j.y+P.y;return X($,B,JJ),`${B},${JJ}`}).join(" ");W.push(`<polygon points="${M}" fill="${D}"${H}/>`)}}if(W.length===0){let I=j.x-V.width/2,w=j.y-V.height/2;W.push(`<rect x="${I}" y="${w}" width="${V.width}" height="${V.height}" fill="${D}"${H}/>`)}}else{let G=j.x-V.width/2,I=j.y-V.height/2;W.push(`<rect x="${G}" y="${I}" width="${V.width}" height="${V.height}" fill="${D}"${H}/>`)}if(K==="thru_hole"||K==="np_thru_hole"){let G=N(Z,"drill");if(G&&G.length>=2)if(E(G[1])&&G[1]==="oval"&&G.length>=4){let w=parseFloat(E(G[2])?G[2]:"0"),M=parseFloat(E(G[3])?G[3]:"0");W.push(`<ellipse cx="${j.x}" cy="${j.y}" rx="${w/2}" ry="${M/2}" fill="${Y.drill}"${H}/>`)}else{let w=parseFloat(E(G[1])?G[1]:"0");W.push(`<circle cx="${j.x}" cy="${j.y}" r="${w/2}" fill="${Y.drill}"/>`)}}if(J){let G=Math.min(V.width,V.height)*0.5;W.push(`<text x="${j.x}" y="${j.y}" fill="#FFFFFF" font-size="${G}" font-family="sans-serif" text-anchor="middle" dominant-baseline="central">${C(J)}</text>`)}return W.join(`
`)}function wJ(Z,$){let J=F(Z,"start"),K=F(Z,"end");if(!J||!K)return"";let U=A(Z),V=T(Z)[0]??"F.SilkS";if(V.includes("CrtYd"))return"";let W=b(V);return X($,J.x,J.y),X($,K.x,K.y),`<line x1="${J.x}" y1="${J.y}" x2="${K.x}" y2="${K.y}" stroke="${W}" stroke-width="${U?.width??0.15}" stroke-linecap="round"/>`}function IJ(Z,$){let J=F(Z,"center"),K=F(Z,"end");if(!J||!K)return"";let U=Math.sqrt((K.x-J.x)**2+(K.y-J.y)**2),j=A(Z),W=T(Z)[0]??"F.SilkS";if(W.includes("CrtYd"))return"";let Q=b(W);return X($,J.x-U,J.y-U),X($,J.x+U,J.y+U),`<circle cx="${J.x}" cy="${J.y}" r="${U}" fill="none" stroke="${Q}" stroke-width="${j?.width??0.15}"/>`}function MJ(Z,$){let J=F(Z,"start"),K=F(Z,"mid"),U=F(Z,"end");if(!J||!K||!U)return"";let j=A(Z),W=T(Z)[0]??"F.SilkS";if(W.includes("CrtYd"))return"";let Q=b(W);return X($,J.x,J.y),X($,K.x,K.y),X($,U.x,U.y),`<path d="${$J(J,K,U)}" fill="none" stroke="${Q}" stroke-width="${j?.width??0.15}" stroke-linecap="round"/>`}function NJ(Z,$){if(!k(Z)||Z.length<3)return"";let J=E(Z[1])?Z[1]:"",K=E(Z[2])?Z[2]:"";if(J==="reference"||J==="value")return"";let U=g(Z,"at");if(!U)return"";let V=T(Z)[0]??"F.SilkS",W=b(V),Q=N(Z,"effects"),D=1;if(Q){let G=N(Q,"font");if(G){let I=l(G);if(I)D=I.height}}X($,U.x-2,U.y-1),X($,U.x+2,U.y+1);let q=U.rotation??0,H=q!==0?` transform="rotate(${q}, ${U.x}, ${U.y})"`:"";return`<text x="${U.x}" y="${U.y}" fill="${W}" font-size="${D}" font-family="sans-serif" text-anchor="middle" dominant-baseline="central"${H}>${C(K)}</text>`}function X(Z,$,J){Z.minX=Math.min(Z.minX,$),Z.maxX=Math.max(Z.maxX,$),Z.minY=Math.min(Z.minY,J),Z.maxY=Math.max(Z.maxY,J)}function f(Z){return`<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 200 100" width="100%" height="100%">
  <rect width="200" height="100" fill="#FFF0F0"/>
  <text x="100" y="50" fill="#CC0000" font-size="12" font-family="sans-serif" text-anchor="middle" dominant-baseline="central">${C(Z)}</text>
</svg>`}var e=1,x="",VJ="user",a=!1,i=null,h=document.getElementById("search-input"),KJ=document.getElementById("source-select"),FJ=document.getElementById("search-btn"),t=document.getElementById("results-grid"),n=document.getElementById("pagination"),_J=document.getElementById("loading"),u=document.getElementById("preview-modal"),c=document.getElementById("modal-content"),YJ=document.getElementById("modal-close");function UJ(){let $=new URLSearchParams(window.location.search).get("q");if($)h.value=$,x=$,L();h.addEventListener("input",zJ),h.addEventListener("keydown",(J)=>{if(J.key==="Enter")J.preventDefault(),L()}),FJ.addEventListener("click",L),KJ.addEventListener("change",()=>{if(VJ=KJ.value,x)L()}),YJ.addEventListener("click",r),u.addEventListener("click",(J)=>{if(J.target===u)r()}),document.addEventListener("keydown",(J)=>{if(J.key==="Escape")r()})}function zJ(){if(i)clearTimeout(i);i=window.setTimeout(()=>{let Z=h.value.trim();if(Z&&Z!==x)x=Z,e=1,L()},300)}async function L(){let Z=h.value.trim();if(!Z||a)return;x=Z,a=!0,jJ(!0);try{let $=new URLSearchParams({q:Z,source:VJ,page:String(e),limit:"20"}),J=await fetch(`/api/search?${$}`);if(!J.ok)throw new Error("Search failed");let K=await J.json();kJ(K.results),BJ(K.pagination)}catch($){console.error("Search error:",$),t.innerHTML='<div class="error">Search failed. Please try again.</div>'}finally{a=!1,jJ(!1)}}function kJ(Z){if(Z.length===0){t.innerHTML='<div class="no-results">No components found. Try a different search term.</div>';return}t.innerHTML=Z.map(($)=>`
    <div class="card" data-uuid="${$.uuid}">
      <div class="card-images">
        <div class="image-container symbol-container" data-uuid="${$.uuid}">
          <div class="symbol-placeholder">Loading...</div>
          <div class="image-label">Symbol</div>
        </div>
        <div class="image-container footprint-container" data-uuid="${$.uuid}">
          <div class="footprint-placeholder">Loading...</div>
          <div class="image-label">Footprint</div>
        </div>
      </div>
      <div class="card-info">
        <div class="card-title" title="${O($.title)}">${O($.title)}</div>
        <div class="card-package">Package: ${O($.package||"Unknown")}</div>
        <div class="card-owner">By: ${O($.owner.nickname||$.owner.username)}</div>
      </div>
      <div class="card-uuid">
        <input type="text" value="${$.uuid}" readonly />
        <button class="copy-btn" data-uuid="${$.uuid}" title="Copy UUID">
          <svg viewBox="0 0 24 24" width="16" height="16"><path fill="currentColor" d="M16 1H4c-1.1 0-2 .9-2 2v14h2V3h12V1zm3 4H8c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h11c1.1 0 2-.9 2-2V7c0-1.1-.9-2-2-2zm0 16H8V7h11v14z"/></svg>
        </button>
      </div>
    </div>
  `).join(""),document.querySelectorAll(".copy-btn").forEach(($)=>{$.addEventListener("click",(J)=>{J.stopPropagation();let K=$.dataset.uuid;if(K)WJ(K,$)})}),document.querySelectorAll(".image-container").forEach(($)=>{$.addEventListener("click",async()=>{let J=$.dataset.uuid;if(J)AJ(J)})}),Z.forEach(($)=>PJ($.uuid))}async function PJ(Z){let $=document.querySelector(`.symbol-container[data-uuid="${Z}"]`),J=document.querySelector(`.footprint-container[data-uuid="${Z}"]`);if(!$&&!J)return;try{let K=await fetch(`/api/component/${Z}`);if(!K.ok){if($)$.innerHTML='<div class="no-preview">Error</div><div class="image-label">Symbol</div>';if(J)J.innerHTML='<div class="no-preview">Error</div><div class="image-label">Footprint</div>';return}let U=await K.json();if($)if(U.symbolSexpr){let j=d(U.symbolSexpr);$.innerHTML=j+'<div class="image-label">Symbol</div>'}else $.innerHTML='<div class="no-preview">No preview</div><div class="image-label">Symbol</div>';if(J)if(U.footprintSexpr){let j=s(U.footprintSexpr);J.innerHTML=j+'<div class="image-label">Footprint</div>'}else J.innerHTML='<div class="no-preview">No preview</div><div class="image-label">Footprint</div>'}catch{if($)$.innerHTML='<div class="no-preview">Error</div><div class="image-label">Symbol</div>';if(J)J.innerHTML='<div class="no-preview">Error</div><div class="image-label">Footprint</div>'}}async function AJ(Z){u.classList.remove("hidden"),c.innerHTML='<div class="modal-loading">Loading...</div>';try{let $=await fetch(`/api/component/${Z}`);if(!$.ok)throw new Error("Failed to fetch component");let J=await $.json(),K=J.symbolSexpr?d(J.symbolSexpr):"",U=J.footprintSexpr?s(J.footprintSexpr):"";c.innerHTML=`
      <div class="modal-header">
        <h2>${O(J.title)}</h2>
        <div class="modal-uuid">
          <code>${J.uuid}</code>
          <button class="copy-btn modal-copy" data-uuid="${J.uuid}">Copy UUID</button>
        </div>
      </div>
      <div class="modal-previews">
        <div class="modal-preview">
          <h3>Symbol (KiCad)</h3>
          <div class="preview-svg">${K||'<div class="no-preview">No symbol preview</div>'}</div>
        </div>
        <div class="modal-preview">
          <h3>Footprint (KiCad)</h3>
          <div class="preview-svg">${U||'<div class="no-preview">No footprint preview</div>'}</div>
        </div>
      </div>
      <div class="modal-info">
        <p><strong>Description:</strong> ${O(J.description||"N/A")}</p>
        ${J.model3d?"<p><strong>3D Model:</strong> Available</p>":""}
      </div>
    `;let j=c.querySelector(".modal-copy");if(j)j.addEventListener("click",()=>{WJ(J.uuid,j)})}catch($){console.error("Modal error:",$),c.innerHTML='<div class="modal-error">Failed to load component details</div>'}}function r(){u.classList.add("hidden")}function BJ(Z){if(Z.totalPages<=1){n.innerHTML="";return}n.innerHTML=`
    <button class="page-btn" ${Z.hasPrev?"":"disabled"} data-page="${Z.page-1}">
      ← Prev
    </button>
    <span class="page-info">Page ${Z.page} of ${Z.totalPages}</span>
    <button class="page-btn" ${Z.hasNext?"":"disabled"} data-page="${Z.page+1}">
      Next →
    </button>
  `,n.querySelectorAll(".page-btn").forEach(($)=>{$.addEventListener("click",()=>{let J=parseInt($.dataset.page||"1",10);if(J>0)e=J,L(),window.scrollTo(0,0)})})}async function WJ(Z,$){try{await navigator.clipboard.writeText(Z),$.classList.add("copied"),setTimeout(()=>$.classList.remove("copied"),1500)}catch{let J=document.createElement("input");J.value=Z,document.body.appendChild(J),J.select(),document.execCommand("copy"),document.body.removeChild(J),$.classList.add("copied"),setTimeout(()=>$.classList.remove("copied"),1500)}}function jJ(Z){_J.classList.toggle("hidden",!Z)}function O(Z){let $=document.createElement("div");return $.textContent=Z,$.innerHTML}if(document.readyState==="loading")document.addEventListener("DOMContentLoaded",UJ);else UJ();

  </script>
</body>
</html>
